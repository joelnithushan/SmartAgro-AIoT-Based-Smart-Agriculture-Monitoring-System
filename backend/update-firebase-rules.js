const admin = require('firebase-admin');const serviceAccount = require('./config/serviceAccountKey.json');admin.initializeApp({  credential: admin.credential.cert(serviceAccount),    databaseURL: 'https:});async function updateFirebaseRules() {  try {    console.log('üîß Updating Firebase Realtime Database rules...');    const currentRules = {      "rules": {        "devices": {          "$deviceId": {            ".read": "auth != null",            ".write": true,            "sensors": {              ".read": "auth != null",              ".write": true            },            "irrigation": {              ".read": "auth != null",              ".write": "auth != null"            }          }        },        "test": {          ".read": "auth != null",          ".write": "auth != null"        }      }    };    const newRules = {      "rules": {        "devices": {          "$deviceId": {            "sensors": {              ".read": "auth != null",              ".write": true,              "latest": {                ".read": "auth != null",                ".write": true              },              "history": {                ".read": "auth != null",                ".write": true,                "$timestamp": {                  ".read": "auth != null",                  ".write": true                }              }            },            "control": {              ".read": "auth != null",              ".write": "auth != null",              "relay": {                ".read": "auth != null",                ".write": "auth != null"              },              "irrigation": {                ".read": "auth != null",                ".write": "auth != null"              }            },            "schedules": {              ".read": "auth != null",              ".write": "auth != null",              "$scheduleId": {                ".read": "auth != null",                ".write": "auth != null"              }            },            "meta": {              ".read": "auth != null",              ".write": "auth != null"            },            "irrigation": {              ".read": "auth != null",              ".write": "auth != null",              "events": {                ".read": "auth != null",                ".write": "auth != null",                "$eventId": {                  ".read": "auth != null",                  ".write": "auth != null"                }              }            },            "status": {              ".read": "auth != null",              ".write": "auth != null"            },            "relay": {              ".read": "auth != null",              ".write": "auth != null"            }          }        },        "users": {          "$uid": {            ".read": "auth != null && auth.uid == $uid",            ".write": "auth != null && auth.uid == $uid",            "devices": {              ".read": "auth != null && auth.uid == $uid",              ".write": "auth != null && auth.uid == $uid",              "$deviceId": {                ".read": "auth != null && auth.uid == $uid",                ".write": "auth != null && auth.uid == $uid"              }            }          }        },        "deviceRequests": {          "$requestId": {            ".read": "auth != null && (data.child('userId').val() == auth.uid || root.child('users').child(auth.uid).child('role').val() == 'admin')",            ".write": "auth != null && (data.child('userId').val() == auth.uid || root.child('users').child(auth.uid).child('role').val() == 'admin')"          }        },        "test": {          ".read": "auth != null",          ".write": "auth != null"        }      }    };    await admin.database().setRules(JSON.stringify(newRules));    console.log('‚úÖ Firebase Realtime Database rules updated successfully!');    console.log('üìã Changes made:');    console.log('   - Added comprehensive sensor data paths (latest, history)');    console.log('   - Added control paths for relay and irrigation');    console.log('   - Added schedule management paths');    console.log('   - Added user management paths');    console.log('   - Added device request paths');    console.log('   - ESP32 can still write sensor data without authentication');    console.log('   - Users can read sensor data with authentication');    console.log('   - Control commands require authentication');    console.log('\nüîê Security model:');    console.log('   - ESP32: Can write sensor data (no auth required)');    console.log('   - Users: Can read sensor data (auth required)');    console.log('   - Users: Can control devices (auth required)');    console.log('   - Users: Can manage schedules (auth required)');    console.log('   - Users: Can access their own profile data');    console.log('   - Device requests protected by ownership');    console.log('\nüéØ This should provide:');    console.log('   1. Full functionality for the SmartAgro system');    console.log('   2. Proper security for user data');    console.log('   3. ESP32 compatibility for sensor data');    console.log('   4. Complete control over irrigation system');  } catch (error) {    console.error('‚ùå Error updating Firebase rules:', error);  } finally {    process.exit(0);  }}updateFirebaseRules();