const admin = require('firebase-admin');const serviceAccount = require('./config/serviceAccountKey.json');admin.initializeApp({  credential: admin.credential.cert(serviceAccount),        databaseURL: 'https:});async function diagnoseESP32Connection() {  console.log('üîç Diagnosing ESP32 Connection Issues...');  console.log('=====================================');  try {    const database = admin.database();    console.log('1. Checking device path: /devices/ESP32_001');    const deviceRef = database.ref('devices/ESP32_001');    const deviceSnapshot = await deviceRef.once('value');    if (deviceSnapshot.exists()) {      console.log('‚úÖ Device path exists');      const deviceData = deviceSnapshot.val();      console.log('üìä Device data keys:', Object.keys(deviceData));      if (deviceData.sensors && deviceData.sensors.latest) {        console.log('‚úÖ Latest sensor data exists');        console.log('üìä Latest data:', JSON.stringify(deviceData.sensors.latest, null, 2));        const latestData = deviceData.sensors.latest;        if (latestData.timestamp) {          const dataAge = Date.now() - latestData.timestamp;          console.log(`‚è∞ Data age: ${Math.round(dataAge / 1000)} seconds ago`);          if (dataAge > 30000) {             console.log('‚ö†Ô∏è  Data is old - ESP32 might not be sending data');          } else {            console.log('‚úÖ Data is recent - ESP32 is sending data');          }        }      } else {        console.log('‚ùå No latest sensor data found');      }      if (deviceData.sensors && deviceData.sensors.history) {        const historyKeys = Object.keys(deviceData.sensors.history);        console.log(`‚úÖ History data exists (${historyKeys.length} entries)`);        if (historyKeys.length > 0) {          const latestHistoryKey = historyKeys[historyKeys.length - 1];          const latestHistory = deviceData.sensors.history[latestHistoryKey];          console.log('üìä Latest history entry:', JSON.stringify(latestHistory, null, 2));        }      } else {        console.log('‚ùå No history data found');      }      if (deviceData.control) {        console.log('‚úÖ Control paths exist');        console.log('üìä Control data:', JSON.stringify(deviceData.control, null, 2));      } else {        console.log('‚ùå No control paths found');      }    } else {      console.log('‚ùå Device path does not exist');      console.log('üîß Possible issues:');      console.log('   - ESP32 not connected to WiFi');      console.log('   - ESP32 not sending data to Firebase');      console.log('   - Wrong device ID in ESP32 code');      console.log('   - Firebase URL incorrect in ESP32');    }    console.log('\n2. Checking all devices in database:');    const allDevicesRef = database.ref('devices');    const allDevicesSnapshot = await allDevicesRef.once('value');    if (allDevicesSnapshot.exists()) {      const allDevices = allDevicesSnapshot.val();      console.log('üìä All device IDs:', Object.keys(allDevices));    } else {      console.log('‚ùå No devices found in database');    }  } catch (error) {    console.error('‚ùå Error during diagnosis:', error);  }  console.log('\n=====================================');  console.log('üîß Troubleshooting Steps:');  console.log('1. Check ESP32 Serial Monitor for errors');  console.log('2. Verify WiFi connection in ESP32');  console.log('3. Check Firebase URL in ESP32 code');  console.log('4. Verify device ID matches (ESP32_001)');  console.log('5. Check Firebase security rules');  console.log('6. Verify ESP32 is actually running the code');  process.exit(0);}diagnoseESP32Connection();